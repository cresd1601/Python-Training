# Tutorial 6: Viewsets and Routers

Django REST Framework's **Tutorial 6** explains how to simplify API views by using **viewsets** and **routers**. Viewsets allow you to combine the logic for listing, creating, retrieving, updating, and deleting resources in a single class, while routers automatically generate the corresponding URL configurations.

## 1. Refactoring with Viewsets

Previously, you would define separate views for each action (like listing, creating, retrieving, updating, and deleting) using `ListCreateAPIView`, `RetrieveUpdateDestroyAPIView`, etc. Now, with **viewsets**, you can combine these actions into a single class.

### Example of Refactoring Your Code:

Before refactoring, your code might look like this:

```python
from rest_framework.generics import ListCreateAPIView, RetrieveUpdateDestroyAPIView, ListAPIView, RetrieveAPIView
from rest_framework.permissions import IsAuthenticatedOrReadOnly, IsAuthenticated
from django.contrib.auth.models import User
from .models import Post
from .serializers import PostSerializer, UserSerializer
from .permissions import IsAuthorOrReadOnly

class PostListView(ListCreateAPIView):
    queryset = Post.objects.all()
    serializer_class = PostSerializer
    permission_classes = [IsAuthenticatedOrReadOnly]

    def perform_create(self, serializer):
        serializer.save(author=self.request.user)

class PostDetailView(RetrieveUpdateDestroyAPIView):
    queryset = Post.objects.all()
    serializer_class = PostSerializer
    permission_classes = [IsAuthenticatedOrReadOnly, IsAuthorOrReadOnly]

class UserListView(ListAPIView):
    queryset = User.objects.all()
    serializer_class = UserSerializer
    permission_classes = [IsAuthenticated]

class UserDetailView(RetrieveAPIView):
    queryset = User.objects.all()
    serializer_class = UserSerializer
    permission_classes = [IsAuthenticated]
```

### Refactored Code Using Viewsets:

With viewsets, you can combine these separate views into fewer classes:

```python
from rest_framework import viewsets
from rest_framework.permissions import IsAuthenticatedOrReadOnly, IsAuthenticated
from django.contrib.auth.models import User
from .models import Post
from .serializers import PostSerializer, UserSerializer
from .permissions import IsAuthorOrReadOnly

class PostViewSet(viewsets.ModelViewSet):
    queryset = Post.objects.all()
    serializer_class = PostSerializer
    permission_classes = [IsAuthenticatedOrReadOnly, IsAuthorOrReadOnly]

    def perform_create(self, serializer):
        serializer.save(author=self.request.user)

class UserViewSet(viewsets.ReadOnlyModelViewSet):
    queryset = User.objects.all()
    serializer_class = UserSerializer
    permission_classes = [IsAuthenticated]
```

- **`PostViewSet`**: A `ModelViewSet` automatically handles listing, creating, retrieving, updating, and deleting posts.
- **`UserViewSet`**: A `ReadOnlyModelViewSet` allows only read operations (listing and retrieving) for users.

## 2. Using Routers

**Routers** automatically generate the URL configurations for your viewsets, reducing the need to manually define paths.

Hereâ€™s the updated `urls.py`:

```python
from django.urls import path, include
from rest_framework.routers import DefaultRouter
from .views import PostViewSet, UserViewSet

router = DefaultRouter()
router.register(r'posts', PostViewSet)
router.register(r'users', UserViewSet)

urlpatterns = [
    path('', include('rest_framework.urls')),  # For login/logout in the browsable API
    path('', include(router.urls)),  # Automatically includes the routes generated by the router
]
```

- **`router.register(r'posts', PostViewSet)`**: Registers the `PostViewSet` with the URL pattern `posts/`.
- **`router.register(r'users', UserViewSet)`**: Registers the `UserViewSet` with the URL pattern `users/`.

## 3. Generated Routes

Using the router, the following routes are automatically generated:

- `/posts/`: List and create posts (GET, POST).
- `/posts/<id>/`: Retrieve, update, and delete a specific post (GET, PUT, DELETE).
- `/users/`: List all users (GET).
- `/users/<id>/`: Retrieve a specific user's details (GET).

## Conclusion

- **Viewsets** simplify your code by combining actions (list, create, retrieve, update, delete) into one class per resource.
- **Routers** automatically generate the required URL routes, reducing the need to manually configure URLs.
- This approach leads to cleaner, more maintainable, and scalable code.
